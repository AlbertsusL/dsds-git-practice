# Use the official Rocker Shiny image as the base image
FROM --platform=linux/amd64 rocker/shiny:latest

# RUN sudo libgdal-dev  libproj-dev libgeos-dev libudunits2-dev netcdf-bin

# Set the working directory
WORKDIR /srv/shiny-server/app

# For shared container
RUN mkdir /srv/shiny-server/backend

# Copy the Shiny app files into the container
COPY frontend/app.R .
COPY frontend/data /srv/shiny-server/app/data
COPY frontend/www /srv/shiny-server/app/www

# Install required R packages for the UI
RUN install2.r --error --skipinstalled \
shiny \
shinyWidgets \
tidyverse \
ggplot2 \
bslib \
leaflet \
shinyjs \
DT \
grid \
lubridate \
readxl \
stringr \
simmer \
simmer.plot \
VGAM \
fitdistrplus \
gridExtra \
parallel \
jsonlite

# Expose the Shiny app port
EXPOSE 3838

CMD ["R", "-e", "shiny::runApp('app.R', port=3838, host='0.0.0.0')"]


